# Malware Behavior Detection Rules
# Deteksi aktivitas malware dan botnet

# ============================================
# COMMAND & CONTROL (C2) COMMUNICATION
# ============================================

- name: "IRC C2 Communication"
  description: "Deteksi komunikasi botnet via IRC"
  severity: "critical"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 6667

- name: "Alternative IRC Port"
  description: "Deteksi IRC pada port non-standard"
  severity: "high"
  enabled: true
  conditions:
    protocol: "TCP"
    port: 6697

- name: "Tor Network Access"
  description: "Deteksi koneksi ke Tor network (possible C2)"
  severity: "medium"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 9050

- name: "Suspicious HTTPS on High Port"
  description: "Deteksi HTTPS pada port tinggi (possible C2)"
  severity: "medium"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 8443

# ============================================
# REVERSE SHELLS & REMOTE ACCESS
# ============================================

- name: "Netcat Reverse Shell"
  description: "Deteksi koneksi netcat reverse shell"
  severity: "critical"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 4444

- name: "Reverse Shell - Port 1234"
  description: "Deteksi reverse shell pada port umum"
  severity: "critical"
  enabled: true
  conditions:
    protocol: "TCP"
    port: 1234

- name: "VNC Remote Access"
  description: "Deteksi akses VNC remote desktop"
  severity: "high"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 5900

- name: "TeamViewer Connection"
  description: "Deteksi koneksi TeamViewer (bisa legitimate atau malicious)"
  severity: "low"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 5938

# ============================================
# RANSOMWARE BEHAVIOR
# ============================================

- name: "SMB Lateral Movement"
  description: "Deteksi lateral movement via SMB (ransomware behavior)"
  severity: "critical"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 445

- name: "WMI Remote Execution"
  description: "Deteksi WMI untuk remote command execution"
  severity: "high"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 135

- name: "RDP Lateral Movement"
  description: "Deteksi RDP untuk lateral movement"
  severity: "high"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 3389

# ============================================
# CRYPTOMINING
# ============================================

- name: "Stratum Mining Protocol"
  description: "Deteksi cryptomining via Stratum protocol"
  severity: "high"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 3333

- name: "Alternative Mining Port"
  description: "Deteksi mining pada port alternatif"
  severity: "high"
  enabled: true
  conditions:
    protocol: "TCP"
    port: 8333

- name: "Monero Mining Pool"
  description: "Deteksi koneksi ke Monero mining pool"
  severity: "high"
  enabled: true
  conditions:
    protocol: "TCP"
    port: 14444

# ============================================
# DATA EXFILTRATION
# ============================================

- name: "FTP Data Upload"
  description: "Deteksi upload data via FTP"
  severity: "high"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 21
    payload_size_gt: 5000

- name: "SFTP Large Transfer"
  description: "Deteksi transfer data besar via SFTP"
  severity: "medium"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 22
    payload_size_gt: 10000

- name: "HTTP POST Large Data"
  description: "Deteksi exfiltration via HTTP POST"
  severity: "high"
  enabled: true
  conditions:
    protocol: "HTTP"
    http_method: "POST"
    payload_size_gt: 50000

- name: "DNS Exfiltration"
  description: "Deteksi data exfiltration via DNS queries"
  severity: "critical"
  enabled: true
  conditions:
    protocol: "DNS"
    payload_size_gt: 256

# ============================================
# EXPLOIT ATTEMPTS
# ============================================

- name: "EternalBlue Exploit (MS17-010)"
  description: "Deteksi percobaan exploit EternalBlue"
  severity: "critical"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 445
    payload_size_gt: 1000

- name: "BlueKeep RDP Exploit (CVE-2019-0708)"
  description: "Deteksi percobaan exploit BlueKeep"
  severity: "critical"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 3389

- name: "Log4Shell Exploit Attempt"
  description: "Deteksi percobaan exploit Log4Shell (CVE-2021-44228)"
  severity: "critical"
  enabled: true
  conditions:
    protocol: "HTTP"
    payload_regex: "\\$\\{jndi:(ldap|rmi|dns)://"

# ============================================
# SUSPICIOUS PROTOCOLS
# ============================================

- name: "TFTP Traffic"
  description: "Deteksi TFTP protocol (often used by malware)"
  severity: "medium"
  enabled: true
  conditions:
    protocol: "UDP"
    dst_port: 69

- name: "Socks Proxy Traffic"
  description: "Deteksi SOCKS proxy (possible C2 or tunneling)"
  severity: "medium"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 1080

- name: "RPC Endpoint Mapper"
  description: "Deteksi akses RPC endpoint mapper (exploit recon)"
  severity: "medium"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 135

# ============================================
# TROJAN SPECIFIC PORTS
# ============================================

- name: "SubSeven Trojan"
  description: "Deteksi SubSeven backdoor trojan"
  severity: "critical"
  enabled: true
  conditions:
    protocol: "TCP"
    port: 27374

- name: "Back Orifice Trojan"
  description: "Deteksi Back Orifice backdoor"
  severity: "critical"
  enabled: true
  conditions:
    protocol: "UDP"
    port: 31337

- name: "Poison Ivy RAT"
  description: "Deteksi Poison Ivy Remote Access Trojan"
  severity: "critical"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 3460

- name: "DarkComet RAT"
  description: "Deteksi DarkComet RAT default port"
  severity: "critical"
  enabled: true
  conditions:
    protocol: "TCP"
    port: 1604

# ============================================
# WORM PROPAGATION
# ============================================

- name: "Conficker Worm Scanning"
  description: "Deteksi aktivitas Conficker worm scanning"
  severity: "critical"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 445

- name: "SQL Slammer Worm"
  description: "Deteksi SQL Slammer worm propagation"
  severity: "critical"
  enabled: true
  conditions:
    protocol: "UDP"
    dst_port: 1434
    payload_size_lt: 500

- name: "Mirai Botnet Scanning"
  description: "Deteksi Mirai botnet IoT scanning"
  severity: "critical"
  enabled: true
  conditions:
    protocol: "TCP"
    port: 23

# ============================================
# PERSISTENCE MECHANISMS
# ============================================

- name: "Windows Admin Share Access"
  description: "Deteksi akses admin shares (C$, ADMIN$)"
  severity: "high"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 445

- name: "WinRM Remote Management"
  description: "Deteksi WinRM untuk remote management/persistence"
  severity: "medium"
  enabled: true
  conditions:
    protocol: "TCP"
    port: 5985

- name: "PowerShell Remoting"
  description: "Deteksi PowerShell remoting (WinRM over HTTPS)"
  severity: "medium"
  enabled: true
  conditions:
    protocol: "TCP"
    dst_port: 5986
